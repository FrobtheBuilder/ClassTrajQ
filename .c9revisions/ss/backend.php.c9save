{"ts":1361331611822,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\r\n\r\nsession_start();\r\nheader(\"Access-Control-Allow-Origin: *\");\r\nheader(\"Access-Control-Allow-Methods: GET, POST\");\r\nheader(\"Content-Type: text/javascript\");\r\n\r\nswitch ($_GET['action']) {\r\n\r\n\tcase \"read\":\r\n\t\techo jsonp(read());\r\n\t\tbreak;\r\n\r\n\tcase \"write\":\r\n\t\techo jsonp(write());\r\n\t\tbreak;\r\n\r\n\tcase \"login\":\r\n\t\techo jsonp(login());\r\n\t\tbreak;\r\n\r\n\tcase \"logout\":\r\n\t\techo jsonp(logout());\r\n\t\tbreak;\r\n\r\n\tcase \"testlogin\":\r\n\t\techo jsonp(testlogin());\r\n\t\tbreak;\r\n\r\n\tcase \"dump\":\r\n\t\tdump();\r\n\t\tbreak;\r\n}\r\n\r\nfunction write() {\r\n\t$var = json_decode(stripslashes($_GET[\"clientclasses\"]));\r\n\t$thefile = fopen($_SESSION['workingdir'].\"/c.json\", \"w+\");\r\n\tfwrite($thefile, json_encode($var));\r\n\treturn json_encode($var);\r\n}\r\n\r\nfunction read() {\r\n\t$thefile = fopen($_SESSION['workingdir'].\"/c.json\", \"r+\");\r\n\t$content = fread($thefile, filesize($_SESSION['workingdir'].\"/c.json\"));\r\n\t$json = json_decode($content);\r\n\t$response = json_encode($json);\r\n\treturn $content;\r\n}\r\n\r\nfunction login() {\r\n\t$user = $_GET['user'];\r\n\t$directory = dirname(__FILE__).\"/profiles/\" . $user;\r\n\tif (!is_dir($directory)) {\r\n\t\tmkdir(dirname(__FILE__).\"/profiles/\" . $user);\r\n\t}\r\n\t$_SESSION['workingdir'] = $directory;\r\n\t$_SESSION['user'] = $user;\r\n\t$response = array(success => true, \"user\" => $_SESSION['user'], \"session\" => session_id());\r\n\treturn json_encode($response);\r\n}\r\n\r\nfunction logout() {\r\n\tsession_unset();\r\n\techo testlogin();\r\n}\r\n\r\nfunction testlogin() {\r\n\tif (isset($_SESSION['user'])) {\r\n\t\t$returned = array(\"loggedin\" => true, \"user\" => $_SESSION['user'], \"session\" => session_id());\r\n\t\treturn json_encode($returned);\r\n\t}\r\n\telse {\r\n\t\t$returned = array(\"loggedin\" => false, \"user\" => \"\", \"session\" => \"\");\r\n\t\treturn json_encode($returned);\r\n\t}\r\n}\r\n\r\nfunction dump() {\r\n\t$returned = array(\"user\" => $_SESSION['user'], \"working directory\" => $_SESSION['workingdir'], );\r\n\techo json_encode($returned);\r\n}\r\n\r\nfunction jsonp($stuff) {\r\n\t$callback = filter_var($_GET['callback'], FILTER_SANITIZE_STRING);\r\n\treturn $callback.'('.$stuff.');';\r\n}\r\n?>"]],"start1":0,"start2":0,"length1":0,"length2":2024}]],"length":2024}
